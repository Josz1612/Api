<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoMarket: De Centralizado a Distribuido</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colores pastel modernos */
            --pastel-blue: #E8F4FD;
            --pastel-green: #E8F5E8;
            --pastel-yellow: #FFF8E1;
            --pastel-pink: #FCE4EC;
            --pastel-purple: #F3E5F5;
            --pastel-orange: #FFF3E0;
            
            /* Colores de acento */
            --blue-accent: #2196F3;
            --green-accent: #4CAF50;
            --yellow-accent: #FF9800;
            --pink-accent: #E91E63;
            --purple-accent: #9C27B0;
            --orange-accent: #FF5722;
            
            /* Colores de texto */
            --text-dark: #2E2E2E;
            --text-medium: #5A5A5A;
            --text-light: #8A8A8A;
            
            /* Espaciado */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            
            /* Bordes */
            --border-radius: 12px;
            --border-radius-lg: 20px;
            
            /* Sombras */
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--pastel-blue) 0%, var(--pastel-purple) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        /* Header */
        .header {
            text-align: center;
            padding: var(--spacing-xl) 0;
            margin-bottom: var(--spacing-lg);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--blue-accent), var(--purple-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-medium);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Barra de progreso */
        .progress-bar {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .progress-track {
            background: #F5F5F5;
            height: 8px;
            border-radius: 4px;
            margin-bottom: var(--spacing-sm);
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--blue-accent), var(--green-accent));
            height: 100%;
            width: 0%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-sm);
        }

        .progress-step {
            font-size: 0.9rem;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .progress-step.active {
            color: var(--blue-accent);
            font-weight: 600;
        }

        .progress-step.completed {
            color: var(--green-accent);
            font-weight: 600;
        }

        /* Navegaci√≥n de fases */
        .phase-nav {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            overflow-x: auto;
            padding: var(--spacing-sm);
        }

        .phase-nav-btn {
            background: white;
            border: 2px solid transparent;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
            text-align: center;
        }

        .phase-nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .phase-nav-btn.active {
            background: var(--blue-accent);
            color: white;
        }

        .phase-nav-btn.fase1 { border-color: var(--pink-accent); }
        .phase-nav-btn.fase2 { border-color: var(--blue-accent); }
        .phase-nav-btn.fase3 { border-color: var(--green-accent); }
        .phase-nav-btn.fase4 { border-color: var(--orange-accent); }

        /* Tarjetas de fase */
        .phase-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            display: none;
            animation: fadeInUp 0.5s ease forwards;
        }

        .phase-card.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 3px solid;
        }

        .phase-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            font-weight: bold;
        }

        .fase1 .phase-header { border-color: var(--pink-accent); }
        .fase1 .phase-icon { background: var(--pink-accent); }

        .fase2 .phase-header { border-color: var(--blue-accent); }
        .fase2 .phase-icon { background: var(--blue-accent); }

        .fase3 .phase-header { border-color: var(--green-accent); }
        .fase3 .phase-icon { background: var(--green-accent); }

        .fase4 .phase-header { border-color: var(--orange-accent); }
        .fase4 .phase-icon { background: var(--orange-accent); }

        .phase-title {
            flex: 1;
        }

        .phase-title h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .phase-duration {
            background: var(--pastel-yellow);
            color: var(--yellow-accent);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Elementos especiales */
        .learning-objective {
            background: var(--pastel-green);
            border-left: 4px solid var(--green-accent);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin: var(--spacing-md) 0;
        }

        .learning-objective h3 {
            color: var(--green-accent);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .warning-box {
            background: var(--pastel-orange);
            border-left: 4px solid var(--orange-accent);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin: var(--spacing-md) 0;
        }

        .warning-box h3 {
            color: var(--orange-accent);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .tip-box {
            background: var(--pastel-purple);
            border-left: 4px solid var(--purple-accent);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin: var(--spacing-md) 0;
        }

        .tip-box h3 {
            color: var(--purple-accent);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        /* Bloques de c√≥digo */
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: var(--spacing-md) 0;
            position: relative;
        }

        .code-header {
            background: #2d2d2d;
            color: #fff;
            padding: var(--spacing-xs) var(--spacing-md);
            margin: calc(-1 * var(--spacing-md)) calc(-1 * var(--spacing-md)) var(--spacing-md) calc(-1 * var(--spacing-md));
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: var(--blue-accent);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .copy-btn:hover {
            background: #1976D2;
        }

        /* Actividades */
        .activity {
            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .activity h3 {
            color: var(--blue-accent);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .activity-steps {
            list-style: none;
            counter-reset: step-counter;
        }

        .activity-steps li {
            counter-increment: step-counter;
            margin-bottom: var(--spacing-md);
            padding-left: 3rem;
            position: relative;
        }

        .activity-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--blue-accent);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Checkpoints */
        .checkpoint {
            background: white;
            border: 2px solid var(--green-accent);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .checkpoint h4 {
            color: var(--green-accent);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .checkpoint-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin: var(--spacing-xs) 0;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--green-accent);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background: var(--green-accent);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
            }

            .header h1 {
                font-size: 2rem;
            }

            .phase-nav {
                flex-direction: column;
            }

            .phase-nav-btn {
                min-width: auto;
            }

            .phase-card {
                padding: var(--spacing-md);
            }
        }

        /* Efectos especiales */
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.6s ease forwards;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üè™ EcoMarket: De Centralizado a Distribuido</h1>
            <p>Una gu√≠a pr√°ctica paso a paso para entender y construir sistemas distribuidos modernos con FastAPI</p>
        </header>

        <!-- Barra de progreso -->
        <div class="progress-bar">
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <span class="progress-step" data-phase="0">Conceptos</span>
                <span class="progress-step" data-phase="1">Implementaci√≥n</span>
                <span class="progress-step" data-phase="2">Comunicaci√≥n</span>
                <span class="progress-step" data-phase="3">Resiliencia</span>
            </div>
        </div>

        <!-- Navegaci√≥n de fases -->
        <nav class="phase-nav">
            <button class="phase-nav-btn fase1 active" onclick="showPhase(0)">
                üéØ Fase 1: Conceptos
            </button>
            <button class="phase-nav-btn fase2" onclick="showPhase(1)">
                üíª Fase 2: C√≥digo
            </button>
            <button class="phase-nav-btn fase3" onclick="showPhase(2)">
                üì¢ Fase 3: Presentaci√≥n
            </button>
            <button class="phase-nav-btn fase4" onclick="showPhase(3)">
                üõ°Ô∏è Fase 4: Resiliencia
            </button>
        </nav>

        <!-- Fase 1: Conceptos y Decisiones -->
        <div class="phase-card fase1 active" data-phase="0">
            <div class="phase-header">
                <div class="phase-icon">üéØ</div>
                <div class="phase-title">
                    <h2>Fase 1: Del Caos a la Claridad</h2>
                    <p>Transformando investigaci√≥n en principios de dise√±o</p>
                </div>
                <div class="phase-duration">45 min</div>
            </div>

            <div class="learning-objective">
                <h3>üéØ Objetivo de Aprendizaje</h3>
                <p>Convertir la investigaci√≥n te√≥rica sobre sistemas distribuidos en principios de dise√±o concretos que guiar√°n la implementaci√≥n de EcoMarket. Al final de esta fase, tendr√°s un "DNA arquitect√≥nico" claro que justifica cada decisi√≥n t√©cnica.</p>
            </div>

            <h3>üè™ El Problema Real: ¬øPor qu√© EcoMarket no puede simplemente "crecer"?</h3>
            <p>EcoMarket ha tenido un √©xito rotundo con su sistema centralizado. Pero ahora enfrentan un problema que no se resuelve con m√°s hardware o mejor internet: <strong>la f√≠sica de la distribuci√≥n</strong>.</p>

            <div class="warning-box">
                <h3>‚ö†Ô∏è Los Tres Enemigos del Crecimiento</h3>
                <p><strong>Latencia:</strong> Cada consulta de inventario debe viajar hasta el servidor central y regresar. Con 200ms de latencia de red, cada venta toma al menos 400ms adicionales.</p>
                <p><strong>Disponibilidad:</strong> Si se cae internet en una sucursal, no pueden vender nada. Perder 2 horas de ventas en d√≠a ocupado puede costar miles de pesos.</p>
                <p><strong>Consistencia:</strong> Sin una estrategia clara, pueden vender el mismo producto m√∫ltiples veces o mostrar stock inexistente.</p>
            </div>

            <div class="activity">
                <h3>üî¨ Actividad: Construyendo Tu DECISIONS.md</h3>
                <p>Este archivo ser√° el "DNA" de tu arquitectura. Cada l√≠nea que escribas debe poder defenderse ante un CEO esc√©ptico.</p>

                <ol class="activity-steps">
                    <li>
                        <strong>Forma equipos diversos:</strong> Necesitas diferentes perspectivas. Una persona act√∫a como "arquitecto de software", otra como "gerente de operaciones" y otra como "representante del cliente".
                    </li>
                    <li>
                        <strong>Revisa tu investigaci√≥n previa:</strong> ¬øQu√© aprendiste de casos como Amazon, Netflix o Spotify? No copies sus soluciones; entiende sus <em>principios</em>.
                    </li>
                    <li>
                        <strong>Completa la plantilla:</strong> Para cada principio, no solo digas qu√© har√°s, sino <em>por qu√©</em> es la decisi√≥n correcta para EcoMarket espec√≠ficamente.
                    </li>
                </ol>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üìù DECISIONS.md - Plantilla</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre># Principios de Dise√±o para EcoMarket

## 1. Principio de Autonom√≠a de Sucursales (Offline-First)

* **Principio Clave que Adoptaremos**: Cada sucursal operar√° de forma aut√≥noma, 
  manteniendo su propio inventario local y procesando ventas sin depender 
  de la conectividad con el servidor central.

* **Justificaci√≥n**: Aprendimos de casos como el de Amazon en sus centros de 
  distribuci√≥n que las fallas en la red central no pueden detener las 
  operaciones cr√≠ticas del negocio. La venta debe completarse inmediatamente.

* **Riesgo que Mitigaremos**: Evitaremos las consultas de inventario s√≠ncronas 
  entre sucursales durante el proceso de venta.

* **Justificaci√≥n**: Una espera de m√°s de 2-3 segundos por una consulta de stock 
  es inaceptable en el punto de venta y genera una mala experiencia del cliente.

## 2. Principio de Consistencia Eventual

* **Principio Clave que Adoptaremos**: Implementaremos un modelo de "consistencia 
  eventual" donde las actualizaciones de inventario se propagan de forma 
  as√≠ncrona entre sucursales.

* **Justificaci√≥n**: Basado en el teorema CAP, priorizamos Disponibilidad 
  (Availability) y Tolerancia a Particiones (Partition Tolerance) sobre 
  Consistencia absoluta, ya que es m√°s importante completar la venta que 
  tener datos perfectamente sincronizados en tiempo real.

* **Riesgo que Mitigaremos**: Posibles sobreventas temporales de productos 
  con stock limitado.

* **Justificaci√≥n**: Es mejor manejar ocasionalmente una sobreventa (que se 
  puede resolver con el cliente) que perder ventas por un sistema no disponible.

## Estrategia de Consistencia

### Modelo Adoptado: Consistencia Eventual

**Trade-off Aceptado**: 
- ‚úÖ **Ganamos**: Ventas r√°pidas, operaci√≥n sin internet, mejor experiencia del cliente
- ‚ö†Ô∏è **Aceptamos**: Posibles discrepancias temporales en el inventario central</pre>
            </div>

            <div class="tip-box">
                <h3>üí° Momento de Reflexi√≥n Cr√≠tica</h3>
                <p><strong>Pregunta para tu equipo:</strong> "Si fueran el CEO de EcoMarket, ¬øpreferir√≠an ocasionalmente sobrevender un producto (que se puede resolver hablando con el cliente) o que su sistema sea lento/no disponible y pierdan ventas definitivamente?"</p>
                <p>Esta pregunta toca el coraz√≥n de los sistemas distribuidos: <strong>no puedes tener todo perfecto, tienes que elegir qu√© optimizar</strong>.</p>
            </div>

            <div class="checkpoint">
                <h4>‚úÖ Checkpoint de Fase 1</h4>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Complet√© el archivo DECISIONS.md con al menos 3 principios bien justificados</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Cada principio est√° conectado con evidencia de mi investigaci√≥n previa</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Puedo explicar cada trade-off en t√©rminos de beneficios de negocio</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Mi equipo revis√≥ y dio feedback sobre nuestros principios de dise√±o</span>
                </div>
            </div>
        </div>

        <!-- Fase 2: Implementaci√≥n -->
        <div class="phase-card fase2" data-phase="1">
            <div class="phase-header">
                <div class="phase-icon">üíª</div>
                <div class="phase-title">
                    <h2>Fase 2: De Principios a C√≥digo</h2>
                    <p>Construyendo autonom√≠a real con FastAPI</p>
                </div>
                <div class="phase-duration">90 min</div>
            </div>

            <div class="learning-objective">
                <h3>üéØ Objetivo de Aprendizaje</h3>
                <p>Transformar los principios abstractos de la Fase 1 en una implementaci√≥n funcional que demuestre autonom√≠a, comunicaci√≥n as√≠ncrona y consistencia eventual. No solo escribir√°s c√≥digo; <strong>materializar√°s conceptos de sistemas distribuidos</strong>.</p>
            </div>

            <h3>üèóÔ∏è Arquitectura del Sistema</h3>
            <p>Vas a construir dos servicios FastAPI que trabajen juntos pero mantengan independencia operacional:</p>

            <div class="activity">
                <h3>üé® Actividad 1: Dise√±o Visual (15 min)</h3>
                <p>Antes de escribir c√≥digo, dibuja la arquitectura. No necesitas ser un artista; necesitas claridad conceptual.</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>Dibuja dos rect√°ngulos:</strong> "API Central" (puerto 8000) y "API Sucursal 1" (puerto 8001)
                    </li>
                    <li>
                        <strong>Indica las comunicaciones:</strong> ¬øLa sucursal "pregunta" al central o "notifica"? Usa flechas con etiquetas claras
                    </li>
                    <li>
                        <strong>Marca los datos:</strong> ¬øD√≥nde vive la "verdad" del inventario? ¬øEn el central, en la sucursal, o en ambos?
                    </li>
                </ol>
            </div>

            <h3>üîß Configuraci√≥n del Proyecto</h3>
            <div class="code-block">
                <div class="code-header">
                    <span>üì¶ requirements.txt</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre>fastapi==0.104.1
uvicorn==0.24.0
httpx==0.25.2
pydantic==2.5.0</pre>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üöÄ Instalaci√≥n</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre># Crear entorno virtual
python -m venv venv

# Activar (Windows)
venv\Scripts\activate

# Activar (Mac/Linux)
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt</pre>
            </div>

            <div class="activity">
                <h3>üíª Actividad 2: API Central - El Cerebro del Sistema (30 min)</h3>
                <p>Esta API mantiene el inventario "maestro" y recibe notificaciones de todas las sucursales.</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üè¢ central_api.py</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre>"""
EcoMarket Central API
Este es el servidor central que mantiene el inventario maestro 
y recibe notificaciones de todas las sucursales.
"""

from fastapi import FastAPI, HTTPException, BackgroundTasks
from pydantic import BaseModel
from typing import Dict, List, Optional
from datetime import datetime
import logging

# Configurar logging para ver las comunicaciones entre servicios
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI(
    title="EcoMarket Central API",
    description="API central que gestiona el inventario maestro",
    version="1.0.0"
)

# ===== MODELOS DE DATOS =====

class Product(BaseModel):
    """Modelo que representa un producto en el inventario"""
    id: int
    name: str
    price: float
    stock: int
    
class SaleNotification(BaseModel):
    """Notificaci√≥n de venta enviada por las sucursales"""
    branch_id: str
    product_id: int
    quantity_sold: int
    timestamp: datetime
    sale_price: float

# ===== INVENTARIO CENTRAL =====
# En un sistema real, esto ser√≠a una base de datos
central_inventory: Dict[int, Product] = {
    1: Product(id=1, name="Manzanas Org√°nicas", price=2.50, stock=100),
    2: Product(id=2, name="Pan Integral", price=1.80, stock=50),
    3: Product(id=3, name="Leche Deslactosada", price=3.20, stock=30),
    4: Product(id=4, name="Caf√© Premium", price=8.90, stock=25),
    5: Product(id=5, name="Quinoa", price=12.50, stock=15)
}

# ===== ENDPOINTS PRINCIPALES =====

@app.get("/", tags=["General"])
async def root():
    """Endpoint de salud del servicio"""
    return {
        "service": "EcoMarket Central API",
        "status": "operational",
        "timestamp": datetime.now(),
        "total_products": len(central_inventory)
    }

@app.get("/inventory", response_model=List[Product], tags=["Inventario"])
async def get_full_inventory():
    """Obtiene todo el inventario central"""
    logger.info("Solicitud de inventario completo recibida")
    return list(central_inventory.values())

@app.post("/sale-notification", tags=["Comunicaci√≥n"])
async def receive_sale_notification(notification: SaleNotification):
    """
    CONCEPTO CLAVE: Comunicaci√≥n as√≠ncrona
    
    Este endpoint recibe notificaciones de venta de las sucursales
    y actualiza el inventario central. Nota que las sucursales
    NO esperan una respuesta para completar su venta.
    """
    logger.info(f"üì¶ Notificaci√≥n de venta recibida: {notification}")
    
    # Verificar que el producto existe
    if notification.product_id not in central_inventory:
        raise HTTPException(
            status_code=404, 
            detail=f"Producto {notification.product_id} no encontrado"
        )
    
    # Actualizar el inventario central
    product = central_inventory[notification.product_id]
    old_stock = product.stock
    product.stock = max(0, product.stock - notification.quantity_sold)
    
    logger.info(
        f"üìä Inventario actualizado - {product.name}: "
        f"{old_stock} ‚Üí {product.stock}"
    )
    
    return {
        "status": "received",
        "message": f"Venta registrada para {notification.quantity_sold} unidades",
        "updated_central_stock": product.stock
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)</pre>
            </div>

            <div class="activity">
                <h3>üè™ Actividad 3: API Sucursal - Autonom√≠a en Acci√≥n (45 min)</h3>
                <p>Esta es donde ocurre la magia: ventas que se procesan inmediatamente sin esperar al servidor central.</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üè™ sucursal_api.py</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre>"""
EcoMarket Sucursal API
Esta API implementa el principio de AUTONOM√çA: puede operar 
independientemente del servidor central.
"""

from fastapi import FastAPI, HTTPException, BackgroundTasks
from pydantic import BaseModel
from typing import Dict, List, Optional
from datetime import datetime
import httpx
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI(
    title="EcoMarket Sucursal API",
    description="API de sucursal aut√≥noma",
    version="1.0.0"
)

# ===== CONFIGURACI√ìN =====
BRANCH_ID = "sucursal-001"
CENTRAL_API_URL = "http://localhost:8000"

# ===== MODELOS =====

class Product(BaseModel):
    id: int
    name: str
    price: float
    stock: int

class SaleRequest(BaseModel):
    product_id: int
    quantity: int
    customer_info: Optional[str] = None

class SaleResponse(BaseModel):
    sale_id: str
    product_name: str
    quantity_sold: int
    total_amount: float
    timestamp: datetime
    status: str

# ===== INVENTARIO LOCAL (AUTONOM√çA) =====
# CONCEPTO CLAVE: Cada sucursal mantiene su propia "verdad local"
local_inventory: Dict[int, Product] = {
    1: Product(id=1, name="Manzanas Org√°nicas", price=2.50, stock=25),
    2: Product(id=2, name="Pan Integral", price=1.80, stock=15),
    3: Product(id=3, name="Leche Deslactosada", price=3.20, stock=8),
    4: Product(id=4, name="Caf√© Premium", price=8.90, stock=6),
    5: Product(id=5, name="Quinoa", price=12.50, stock=3)
}

sales_history: List[SaleResponse] = []

# ===== ENDPOINTS =====

@app.get("/", tags=["General"])
async def root():
    return {
        "service": f"EcoMarket Sucursal",
        "branch_id": BRANCH_ID,
        "status": "operational - AUTONOMOUS",
        "local_inventory_items": len(local_inventory),
        "total_sales": len(sales_history)
    }

@app.get("/inventory", response_model=List[Product], tags=["Inventario"])
async def get_local_inventory():
    """
    CONCEPTO CLAVE: Consulta local instant√°nea
    
    Esta consulta no va al servidor central. Es inmediata
    porque consulta el inventario local de la sucursal.
    """
    logger.info("üè™ Consultando inventario LOCAL (operaci√≥n aut√≥noma)")
    return list(local_inventory.values())

@app.post("/sales", response_model=SaleResponse, tags=["Ventas"])
async def process_sale(sale_request: SaleRequest, background_tasks: BackgroundTasks):
    """
    CONCEPTO CLAVE: Procesamiento aut√≥nomo de ventas
    
    Este es el coraz√≥n de la autonom√≠a:
    1. Verifica stock LOCAL inmediatamente
    2. Procesa la venta SIN esperar al servidor central  
    3. Env√≠a notificaci√≥n al central de forma AS√çNCRONA
    """
    
    # PASO 1: Verificaci√≥n inmediata contra inventario local
    if sale_request.product_id not in local_inventory:
        raise HTTPException(status_code=404, detail="Producto no disponible")
    
    product = local_inventory[sale_request.product_id]
    
    if product.stock < sale_request.quantity:
        raise HTTPException(
            status_code=400,
            detail=f"Stock insuficiente. Disponible: {product.stock}"
        )
    
    # PASO 2: Procesar la venta INMEDIATAMENTE
    product.stock -= sale_request.quantity
    sale_timestamp = datetime.now()
    total_amount = product.price * sale_request.quantity
    
    sale_response = SaleResponse(
        sale_id=f"{BRANCH_ID}_{sale_timestamp.isoformat()}",
        product_name=product.name,
        quantity_sold=sale_request.quantity,
        total_amount=total_amount,
        timestamp=sale_timestamp,
        status="completed"
    )
    
    sales_history.append(sale_response)
    
    logger.info(
        f"üí∞ Venta procesada LOCALMENTE: {sale_request.quantity}x {product.name} "
        f"por ${total_amount:.2f}. Stock restante: {product.stock}"
    )
    
    # PASO 3: Notificar al central de forma AS√çNCRONA
    # Esta operaci√≥n NO bloquea la respuesta al cliente
    background_tasks.add_task(
        notify_central_about_sale,
        sale_request.product_id,
        sale_request.quantity,
        sale_timestamp,
        total_amount
    )
    
    return sale_response

async def notify_central_about_sale(
    product_id: int,
    quantity_sold: int,
    timestamp: datetime,
    sale_amount: float
):
    """
    CONCEPTO CLAVE: Comunicaci√≥n as√≠ncrona resiliente
    
    Esta funci√≥n se ejecuta en segundo plano.
    Si falla, la venta ya est√° completada localmente.
    """
    notification = {
        "branch_id": BRANCH_ID,
        "product_id": product_id,
        "quantity_sold": quantity_sold,
        "timestamp": timestamp.isoformat(),
        "sale_price": sale_amount
    }
    
    try:
        async with httpx.AsyncClient(timeout=5.0) as client:
            logger.info("üì° Enviando notificaci√≥n al servidor central...")
            
            response = await client.post(
                f"{CENTRAL_API_URL}/sale-notification",
                json=notification
            )
            
            if response.status_code == 200:
                logger.info("‚úÖ Notificaci√≥n enviada exitosamente")
            else:
                logger.warning(f"‚ö†Ô∏è Respuesta inesperada: {response.status_code}")
                
    except Exception as e:
        logger.error(f"‚ùå Error al notificar al central: {e}")
        # IMPORTANTE: La venta YA est√° completada, esto es solo notificaci√≥n

@app.get("/sales/stats", tags=["Ventas"])
async def get_sales_stats():
    """Estad√≠sticas de ventas de la sucursal"""
    if not sales_history:
        return {"total_sales": 0, "total_revenue": 0}
    
    total_revenue = sum(sale.total_amount for sale in sales_history)
    return {
        "total_sales": len(sales_history),
        "total_revenue": round(total_revenue, 2),
        "average_sale": round(total_revenue / len(sales_history), 2)
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8001)</pre>
            </div>

            <div class="tip-box">
                <h3>üß† Momento de Comprensi√≥n Profunda</h3>
                <p><strong>Pregunta cr√≠tica:</strong> "¬øEn qu√© orden exacto ocurren estos pasos en tu c√≥digo de venta?"</p>
                <p>1. Verificar stock local ‚Üí 2. Actualizar inventario local ‚Üí 3. Responder al cliente ‚Üí 4. Notificar al central</p>
                <p><strong>¬øPor qu√© ese orden es crucial?</strong> Porque garantiza que la experiencia del cliente no depende de la red. El cliente recibe confirmaci√≥n inmediata, y la sincronizaci√≥n ocurre despu√©s.</p>
            </div>

            <div class="activity">
                <h3>üöÄ Actividad 4: Primera Demo del Sistema (20 min)</h3>
                <p>Es momento de ver tu sistema distribuido en acci√≥n.</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>Terminal 1:</strong> <code>python central_api.py</code>
                    </li>
                    <li>
                        <strong>Terminal 2:</strong> <code>python sucursal_api.py</code>
                    </li>
                    <li>
                        <strong>Abrir navegador:</strong> 
                        <br>‚Ä¢ Central: <code>http://localhost:8000/docs</code>
                        <br>‚Ä¢ Sucursal: <code>http://localhost:8001/docs</code>
                    </li>
                    <li>
                        <strong>Procesar una venta:</strong> Usa la interfaz de FastAPI para vender 5 manzanas
                    </li>
                    <li>
                        <strong>Observar logs:</strong> Ve c√≥mo la venta se procesa localmente y luego se notifica al central
                    </li>
                </ol>
            </div>

            <div class="checkpoint">
                <h4>‚úÖ Checkpoint de Fase 2</h4>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Ambas APIs est√°n corriendo y responden en sus puertos</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Proces√© al menos una venta exitosamente</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Vi los logs mostrando la secuencia: venta local ‚Üí notificaci√≥n central</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Puedo explicar por qu√© la venta se completa antes de notificar al central</span>
                </div>
            </div>
        </div>

        <!-- Fase 3: Presentaci√≥n -->
        <div class="phase-card fase3" data-phase="2">
            <div class="phase-header">
                <div class="phase-icon">üì¢</div>
                <div class="phase-title">
                    <h2>Fase 3: Vendiendo la Visi√≥n</h2>
                    <p>Traduciendo decisiones t√©cnicas en valor de negocio</p>
                </div>
                <div class="phase-duration">45 min</div>
            </div>

            <div class="learning-objective">
                <h3>üéØ Objetivo de Aprendizaje</h3>
                <p>Desarrollar la habilidad profesional cr√≠tica de comunicar decisiones t√©cnicas complejas a audiencias no t√©cnicas. Al final, podr√°s justificar cualquier inversi√≥n en arquitectura distribuida en t√©rminos de beneficios concretos de negocio.</p>
            </div>

            <div class="warning-box">
                <h3>‚ö†Ô∏è El Reto de Comunicaci√≥n</h3>
                <p>Los mejores arquitectos pueden explicar por qu√© su soluci√≥n vale millones de pesos de inversi√≥n. Tu reto: convencer a un CEO que no programa, pero s√≠ entiende de costos, riesgos y experiencia del cliente.</p>
            </div>

            <div class="activity">
                <h3>üé≠ Actividad 1: Role-Playing Empresarial (20 min)</h3>
                <p>Vamos a simular una junta directiva real. Necesitas roles espec√≠ficos para que funcione:</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>El CEO (esc√©ptico):</strong> Pregunta por costos, riesgos, y ROI. No le importa la tecnolog√≠a, le importa el negocio.
                    </li>
                    <li>
                        <strong>El Arquitecto (t√∫):</strong> Debe traducir cada concepto t√©cnico en beneficio empresarial medible.
                    </li>
                    <li>
                        <strong>El Gerente de Operaciones:</strong> Entiende los dolores de las sucursales y puede validar si la soluci√≥n los resuelve.
                    </li>
                    <li>
                        <strong>El Representante de Clientes:</strong> Se enfoca en la experiencia del usuario final.
                    </li>
                </ol>
            </div>

            <h3>üìä Framework de Presentaci√≥n: De Problema a Soluci√≥n</h3>

            <div class="code-block">
                <div class="code-header">
                    <span>üéØ Estructura de 5 Diapositivas</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre>DIAPOSITIVA 1: EL COSTO DE NO ACTUAR
‚ùå Con sistema actual (centralizado):
‚Ä¢ Cada venta toma 3-5 segundos extra por verificaci√≥n de red
‚Ä¢ Si internet falla 2 horas, perdemos 100% de ventas en esa sucursal
‚Ä¢ Clientes frustrados por lentitud = p√©rdida de reputaci√≥n

üí∞ Impacto real: En d√≠a ocupado (500 ventas), sistema lento puede
    costar 2-3 ventas perdidas por impaciencia = $200-300 perdidos

DIAPOSITIVA 2: NUESTRA SOLUCI√ìN - AUTONOM√çA INTELIGENTE
‚úÖ Sistema distribuido con autonom√≠a:
‚Ä¢ Ventas instant√°neas (menos de 100ms vs 3000ms)
‚Ä¢ Operaci√≥n garantizada sin internet
‚Ä¢ Sincronizaci√≥n inteligente en segundo plano

üéØ Beneficio clave: NUNCA perdemos una venta por problemas t√©cnicos

DIAPOSITIVA 3: DECISIONES BASADAS EN EVIDENCIA
üìö Nuestros principios vienen de casos reales:
‚Ä¢ Amazon: Autonom√≠a de centros de distribuci√≥n
‚Ä¢ Netflix: Consistencia eventual para escalabilidad
‚Ä¢ Spotify: Comunicaci√≥n as√≠ncrona para resiliencia

üß† No estamos inventando; estamos aplicando patrones probados

DIAPOSITIVA 4: DEMO EN VIVO
[Mostrar venta proces√°ndose en milisegundos]
üöÄ "Observen: venta completada ANTES de que termine de hablar"
üìä "Inventario se actualiza autom√°ticamente en el central"
üõ°Ô∏è "Si desconecto internet, la sucursal sigue vendiendo"

DIAPOSITIVA 5: PR√ìXIMOS PASOS Y ROI
üí° Pr√≥xima semana: A√±adir Circuit Breaker para m√°xima resiliencia
üìà ROI esperado: 
‚Ä¢ Reducir tiempo de venta: 70% m√°s r√°pido
‚Ä¢ Eliminar ventas perdidas por fallas: +5% ingresos
‚Ä¢ Reducir llamadas de soporte: -40% tickets relacionados con lentitud</pre>
            </div>

            <div class="activity">
                <h3>üé§ Actividad 2: Elevator Pitch Perfecto (15 min)</h3>
                <p>Cada miembro del equipo prepara un discurso de exactamente 2 minutos. El objetivo: convencer al CEO en el tiempo que dura un viaje en elevador.</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>Minuto 1:</strong> El problema (p√©rdida de dinero por sistema lento/no disponible)
                    </li>
                    <li>
                        <strong>Minuto 2:</strong> La soluci√≥n (ventas instant√°neas + operaci√≥n sin internet)
                    </li>
                    <li>
                        <strong>Practicar:</strong> Cron√≥metren y refinen hasta que fluya naturalmente
                    </li>
                </ol>
            </div>

            <div class="tip-box">
                <h3>üí° T√©cnicas de Comunicaci√≥n Efectiva</h3>
                <p><strong>Usa n√∫meros concretos:</strong> En lugar de "m√°s r√°pido", di "70% reducci√≥n en tiempo de venta"</p>
                <p><strong>Habla en t√©rminos de dinero:</strong> "Cada segundo de demora cuesta aproximadamente $X en ventas perdidas"</p>
                <p><strong>Usa analog√≠as:</strong> "Es como tener una sucursal que funciona incluso si se corta el tel√©fono con la matriz"</p>
                <p><strong>Anticipa objeciones:</strong> Ten respuestas preparadas para "¬øQu√© pasa si...?" y "¬øCu√°nto cuesta...?"</p>
            </div>

            <div class="activity">
                <h3>üîÑ Actividad 3: Feedback y Refinamiento (10 min)</h3>
                <p>Despu√©s de cada presentaci√≥n, rotaci√≥n de roles para dar feedback constructivo:</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>El "CEO" dice:</strong> ¬øQu√© entend√≠? ¬øQu√© me convenci√≥? ¬øQu√© dudas me quedaron?
                    </li>
                    <li>
                        <strong>El equipo refina:</strong> Ajustar el mensaje basado en feedback inmediato
                    </li>
                    <li>
                        <strong>Segunda iteraci√≥n:</strong> Presentar versi√≥n mejorada
                    </li>
                </ol>
            </div>

            <div class="learning-objective">
                <h3>üß† Reflexi√≥n Meta-Cognitiva</h3>
                <p><strong>Pregunta profunda:</strong> "¬øQu√© fue m√°s dif√≠cil: escribir el c√≥digo o explicar por qu√© vale la pena la inversi√≥n?"</p>
                <p>Esta reflexi√≥n toca una realidad profesional: las mejores soluciones t√©cnicas fracasan si no se pueden comunicar efectivamente. La habilidad de traducir complejidad t√©cnica en valor de negocio es lo que distingue a arquitectos senior de desarrolladores junior.</p>
            </div>

            <div class="checkpoint">
                <h4>‚úÖ Checkpoint de Fase 3</h4>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Complet√© las 5 diapositivas con contenido espec√≠fico de mi implementaci√≥n</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Mi elevator pitch dura exactamente 2 minutos y convence con n√∫meros concretos</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Puedo responder preguntas esc√©pticas sobre costos y riesgos</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Mi demo muestra valor tangible (velocidad, autonom√≠a) no solo funcionalidad</span>
                </div>
            </div>
        </div>

        <!-- Fase 4: Resiliencia -->
        <div class="phase-card fase4" data-phase="3">
            <div class="phase-header">
                <div class="phase-icon">üõ°Ô∏è</div>
                <div class="phase-title">
                    <h2>Fase 4: Prepar√°ndose para el Caos</h2>
                    <p>Patrones de resiliencia para sistemas distribuidos</p>
                </div>
                <div class="phase-duration">30 min</div>
            </div>

            <div class="learning-objective">
                <h3>üéØ Objetivo de Aprendizaje</h3>
                <p>Comprender que los sistemas distribuidos no solo deben funcionar cuando todo va bien, sino especialmente cuando todo va mal. Explorar√°s patrones de resiliencia que distinguen sistemas amateur de sistemas de producci√≥n real.</p>
            </div>

            <h3>ü§î El Siguiente Problema Natural</h3>
            <p>Tu sistema funciona perfectamente... hasta que no. ¬øQu√© pasa cuando la comunicaci√≥n entre sucursal y central falla repetidamente? Tu implementaci√≥n actual reintenta indefinidamente, lo cual puede sobrecargar un sistema ya problem√°tico.</p>

            <div class="warning-box">
                <h3>‚ö†Ô∏è El Problema del "Retry Hell"</h3>
                <p><strong>Escenario:</strong> El servidor central est√° sobrecargado y responde lentamente. Cada sucursal sigue intentando enviar notificaciones, empeorando el problema.</p>
                <p><strong>Resultado:</strong> Un sistema distribuido que se auto-destruye por ser "demasiado persistente".</p>
            </div>

            <div class="activity">
                <h3>üß† Actividad de Investigaci√≥n: Circuit Breaker Pattern</h3>
                <p>Antes de la pr√≥xima clase, investiga y responde en tu diario de aprendizaje:</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>En mis propias palabras:</strong> ¬øQu√© es el patr√≥n Circuit Breaker? (Sin copiar definiciones de internet)
                    </li>
                    <li>
                        <strong>Aplicado a EcoMarket:</strong> ¬øC√≥mo actuar√≠a un Circuit Breaker si la API de la sucursal no puede comunicarse con la API central repetidamente?
                    </li>
                    <li>
                        <strong>Comparaci√≥n cr√≠tica:</strong> ¬øPor qu√© una estrategia de Timeout simple no es suficiente? ¬øQu√© ventaja clave ofrece el Circuit Breaker?
                    </li>
                    <li>
                        <strong>Predicci√≥n:</strong> ¬øQu√© otros problemas podr√≠an surgir si EcoMarket crece a 100 sucursales simult√°neas?
                    </li>
                </ol>
            </div>

            <div class="tip-box">
                <h3>üí° Analog√≠a para Entender Circuit Breaker</h3>
                <p><strong>Piensa en tu tel√©fono m√≥vil:</strong> Cuando no hay se√±al, ¬øintentas llamar cada segundo durante una hora, o te das por vencido despu√©s de algunos intentos y lo intentas m√°s tarde?</p>
                <p><strong>Circuit Breaker es esa "inteligencia":</strong> Reconoce cuando algo est√° roto y deja de intentar temporalmente, dando tiempo al sistema para recuperarse.</p>
                <p><strong>Tres estados:</strong> Cerrado (funciona normal), Abierto (deja de intentar), Medio-abierto (prueba ocasionalmente si ya se recuper√≥)</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üõ°Ô∏è Ejemplo: Circuit Breaker Simple</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre># Para la pr√≥xima semana - implementaci√≥n avanzada con circuit breaker

from enum import Enum
from datetime import datetime, timedelta

class CircuitState(Enum):
    CLOSED = "closed"      # Funcionando normal
    OPEN = "open"          # Bloqueado por fallos
    HALF_OPEN = "half_open" # Probando si ya se recuper√≥

class CircuitBreaker:
    def __init__(self, failure_threshold=5, recovery_timeout=30):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED
    
    async def call(self, func, *args, **kwargs):
        """Ejecuta funci√≥n con protecci√≥n de circuit breaker"""
        
        if self.state == CircuitState.OPEN:
            # ¬øYa pas√≥ suficiente tiempo para intentar de nuevo?
            if self._should_attempt_reset():
                self.state = CircuitState.HALF_OPEN
            else:
                raise Exception("Circuit breaker est√° abierto")
        
        try:
            # Intentar la operaci√≥n
            result = await func(*args, **kwargs)
            self._on_success()
            return result
            
        except Exception as e:
            self._on_failure()
            raise e
    
    def _on_success(self):
        """Resetear contador en caso de √©xito"""
        self.failure_count = 0
        self.state = CircuitState.CLOSED
    
    def _on_failure(self):
        """Incrementar fallos y posiblemente abrir el circuito"""
        self.failure_count += 1
        self.last_failure_time = datetime.now()
        
        if self.failure_count >= self.failure_threshold:
            self.state = CircuitState.OPEN

# Uso en la sucursal:
# circuit_breaker = CircuitBreaker(failure_threshold=3, recovery_timeout=60)
# await circuit_breaker.call(notify_central_about_sale, ...)</pre>
            </div>

            <div class="activity">
                <h3>üîÆ Actividad de Proyecci√≥n: Escalando a 100 Sucursales</h3>
                <p>Imagina que EcoMarket tiene un √©xito masivo y abre 100 sucursales. ¬øQu√© nuevos problemas emerger√≠an con tu arquitectura actual?</p>
                
                <ol class="activity-steps">
                    <li>
                        <strong>Volumen de notificaciones:</strong> ¬øPuede el servidor central manejar notificaciones de 100 sucursales simult√°neamente?
                    </li>
                    <li>
                        <strong>Sincronizaci√≥n de inventario:</strong> ¬øC√≥mo propagar cambios de precios o nuevos productos a 100 sucursales?
                    </li>
                    <li>
                        <strong>Monitoreo y observabilidad:</strong> ¬øC√≥mo saber si alguna sucursal tiene problemas sin revisarlas una por una?
                    </li>
                    <li>
                        <strong>Particionado de datos:</strong> ¬øDeber√≠a cada regi√≥n tener su propio servidor central?
                    </li>
                </ol>
            </div>

            <div class="learning-objective">
                <h3>üéì Hacia Patrones M√°s Avanzados</h3>
                <p>Los conceptos que explorar√°s despu√©s incluyen:</p>
                <ul>
                    <li><strong>Event Sourcing:</strong> En lugar de almacenar estado, almacenar secuencia de eventos</li>
                    <li><strong>CQRS:</strong> Separar operaciones de lectura y escritura para mejor rendimiento</li>
                    <li><strong>Saga Pattern:</strong> Manejar transacciones distribuidas de larga duraci√≥n</li>
                    <li><strong>API Gateway:</strong> Punto √∫nico de entrada para m√∫ltiples servicios</li>
                </ul>
                <p>Cada uno resuelve problemas espec√≠ficos que emergen al escalar sistemas distribuidos.</p>
            </div>

            <div class="checkpoint">
                <h4>‚úÖ Checkpoint de Fase 4</h4>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Entiendo por qu√© los reintentos simples pueden empeorar un problema</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Puedo explicar Circuit Breaker con una analog√≠a del mundo real</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Identifiqu√© al menos 3 problemas de escalabilidad para 100 sucursales</span>
                </div>
                <div class="checkpoint-item">
                    <div class="checkbox" onclick="toggleCheck(this)"></div>
                    <span>Complet√© mi investigaci√≥n sobre patrones de resiliencia</span>
                </div>
            </div>
        </div>

        <!-- Footer de progreso -->
        <footer style="text-align: center; padding: 2rem; margin-top: 2rem; background: white; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-md);">
            <h3 style="color: var(--blue-accent); margin-bottom: 1rem;">üéâ ¬°Felicitaciones!</h3>
            <p>Has completado un viaje desde conceptos abstractos hasta implementaci√≥n concreta de sistemas distribuidos. Ahora tienes las herramientas conceptuales y pr√°cticas para construir sistemas escalables y resilientes.</p>
            <div style="margin-top: 1.5rem;">
                <button onclick="resetProgress()" style="background: var(--green-accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--border-radius); cursor: pointer;">
                    üîÑ Reiniciar Progreso
                </button>
            </div>
        </footer>
    </div>

    <script>
        let currentPhase = 0;
        const totalPhases = 4;

        function showPhase(phaseIndex) {
            // Ocultar todas las fases
            document.querySelectorAll('.phase-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Mostrar la fase seleccionada
            document.querySelector(`.phase-card[data-phase="${phaseIndex}"]`).classList.add('active');
            
            // Actualizar navegaci√≥n
            document.querySelectorAll('.phase-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.phase-nav-btn')[phaseIndex].classList.add('active');
            
            // Actualizar progreso
            currentPhase = phaseIndex;
            updateProgress();
        }

        function updateProgress() {
            const progressPercentage = ((currentPhase + 1) / totalPhases) * 100;
            document.getElementById('progressFill').style.width = `${progressPercentage}%`;
            
            // Actualizar steps
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < currentPhase) {
                    step.classList.add('completed');
                } else if (index === currentPhase) {
                    step.classList.add('active');
                }
            });
        }

        function toggleCheck(checkbox) {
            checkbox.classList.toggle('checked');
            if (checkbox.classList.contains('checked')) {
                checkbox.innerHTML = '‚úì';
            } else {
                checkbox.innerHTML = '';
            }
        }

        function copyCode(button) {
            const codeBlock = button.parentElement.nextElementSibling;
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '¬°Copiado!';
                button.style.background = '#4CAF50';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#2196F3';
                }, 2000);
            });
        }

        function resetProgress() {
            if (confirm('¬øEst√°s seguro que quieres reiniciar todo el progreso?')) {
                // Reiniciar checkboxes
                document.querySelectorAll('.checkbox').forEach(checkbox => {
                    checkbox.classList.remove('checked');
                    checkbox.innerHTML = '';
                });
                
                // Volver a la primera fase
                showPhase(0);
                
                alert('Progreso reiniciado. ¬°A empezar de nuevo!');
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
        });

        // Navegaci√≥n con teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' && currentPhase < totalPhases - 1) {
                showPhase(currentPhase + 1);
            } else if (e.key === 'ArrowLeft' && currentPhase > 0) {
                showPhase(currentPhase - 1);
            }
        });
    </script>
</body>
</html>